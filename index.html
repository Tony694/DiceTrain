<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Train</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- Main Menu Screen -->
        <div id="menu-screen" class="screen active">
            <h1>Dice Train</h1>
            <p class="menu-subtitle">Est. 1869</p>
            <div class="menu-container">
                <button id="menu-single-player" class="btn btn-primary menu-btn">Single Player</button>
                <button id="menu-host-game" class="btn btn-primary menu-btn">Host Multiplayer</button>
                <button id="menu-browse-lobbies" class="btn btn-primary menu-btn">Browse Lobbies</button>
                <button id="menu-options" class="btn btn-secondary menu-btn">Game Options</button>
            </div>
        </div>

        <!-- Options Screen -->
        <div id="options-screen" class="screen">
            <h1>Game Options</h1>
            <div class="options-container">
                <div class="option-row">
                    <label for="option-sound-enabled">Sound Effects</label>
                    <div class="option-control">
                        <input type="checkbox" id="option-sound-enabled" checked>
                        <span class="toggle-label">On</span>
                    </div>
                </div>
                <div class="option-row">
                    <label for="option-volume">Sound Volume</label>
                    <div class="option-control">
                        <input type="range" id="option-volume" min="0" max="100" value="50">
                        <span id="volume-display">50%</span>
                    </div>
                </div>
                <div class="option-row">
                    <label for="option-ai-speed">AI Player Speed</label>
                    <div class="option-control">
                        <select id="option-ai-speed">
                            <option value="slow">Slow (2s delay)</option>
                            <option value="normal" selected>Normal (1s delay)</option>
                            <option value="fast">Fast (0.5s delay)</option>
                            <option value="instant">Instant</option>
                        </select>
                    </div>
                </div>
                <div class="options-buttons">
                    <button id="save-options" class="btn btn-primary">Save & Back</button>
                    <button id="reset-options" class="btn btn-secondary">Reset to Defaults</button>
                </div>
            </div>
        </div>

        <!-- Lobby Screen (Host) -->
        <div id="lobby-screen" class="screen">
            <h1>Host Multiplayer</h1>
            <div class="lobby-container">
                <div class="lobby-config">
                    <div class="lobby-option">
                        <label for="lobby-name">Lobby Name</label>
                        <input type="text" id="lobby-name" placeholder="My Game" maxlength="30">
                    </div>
                    <div class="lobby-option">
                        <label for="lobby-password">Password (Optional)</label>
                        <input type="password" id="lobby-password" placeholder="Leave blank for public">
                    </div>
                    <div class="lobby-option">
                        <label for="lobby-max-players">Total Players</label>
                        <select id="lobby-max-players">
                            <option value="2">2 Players</option>
                            <option value="3">3 Players</option>
                            <option value="4" selected>4 Players</option>
                        </select>
                    </div>
                    <div class="lobby-option">
                        <label for="lobby-rounds">Number of Rounds</label>
                        <select id="lobby-rounds">
                            <option value="8">8 Rounds</option>
                            <option value="12" selected>12 Rounds</option>
                            <option value="16">16 Rounds</option>
                            <option value="20">20 Rounds</option>
                        </select>
                    </div>
                </div>
                <div class="lobby-code-display">
                    <label>Lobby Code (Share with friends)</label>
                    <div class="lobby-code" id="lobby-code">Generating...</div>
                    <button id="copy-lobby-code" class="btn btn-secondary">Copy Code</button>
                </div>
                <div class="lobby-players-section">
                    <h3>Players in Lobby</h3>
                    <div id="lobby-players"></div>
                    <button id="add-ai-player" class="btn btn-secondary">+ Add AI Player</button>
                </div>
                <div class="lobby-buttons">
                    <button id="start-lobby-game" class="btn btn-primary" disabled>Start Game</button>
                    <button id="cancel-lobby" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Browser Screen (Join) -->
        <div id="browser-screen" class="screen">
            <h1>Browse Lobbies</h1>
            <div class="browser-container">
                <div class="join-manual">
                    <label for="join-code">Enter Lobby Code</label>
                    <div class="join-input-row">
                        <input type="text" id="join-code" placeholder="Enter code from host">
                        <button id="join-lobby-btn" class="btn btn-primary">Join</button>
                    </div>
                </div>
                <div class="join-name">
                    <label for="join-player-name">Your Name</label>
                    <input type="text" id="join-player-name" placeholder="Player" maxlength="20">
                </div>
                <div id="join-status" class="join-status hidden"></div>
                <button id="back-to-menu-browser" class="btn btn-secondary">Back to Menu</button>
            </div>
        </div>

        <!-- Setup Screen (Single Player) -->
        <div id="setup-screen" class="screen">
            <h1>Dice Train</h1>
            <div class="setup-container">
                <div class="setup-option">
                    <label for="player-count">Number of Players</label>
                    <select id="player-count">
                        <option value="1" selected>1 Player (Solo)</option>
                        <option value="2">2 Players</option>
                        <option value="3">3 Players</option>
                        <option value="4">4 Players</option>
                    </select>
                </div>
                <div class="setup-option">
                    <label for="round-count">Number of Rounds</label>
                    <select id="round-count">
                        <option value="8">8 Rounds</option>
                        <option value="12" selected>12 Rounds</option>
                        <option value="16">16 Rounds</option>
                        <option value="20">20 Rounds</option>
                    </select>
                </div>
                <div id="player-names"></div>
                <div class="setup-buttons">
                    <button id="start-game" class="btn btn-primary">Start Game</button>
                    <button id="back-to-menu-setup" class="btn btn-secondary">Back to Menu</button>
                </div>
            </div>
        </div>

        <!-- Draft Screen -->
        <div id="draft-screen" class="screen">
            <div class="draft-container">
                <h2>Card Draft</h2>
                <p class="draft-player">Player: <span id="draft-player-name">Player 1</span></p>
                <p class="draft-instructions">Select 2 of 3 cards to add to your hand</p>
                <div id="draft-cards"></div>
                <button id="confirm-draft" class="btn btn-primary" disabled>Confirm Selection (0/2)</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <header class="game-header">
                <div class="round-info">
                    Round <span id="current-round">1</span> / <span id="total-rounds">10</span>
                </div>
                <div id="current-player-display">
                    <span id="current-player-name">Player 1</span>'s Turn
                </div>
                <div class="phase-indicator">
                    <span class="phase" data-phase="roll">Roll</span>
                    <span class="phase" data-phase="station">Station</span>
                    <span class="phase" data-phase="shop">Shop</span>
                </div>
            </header>

            <!-- Railroad Map Board -->
            <div id="railroad-map" class="railroad-map">
                <div class="map-container">
                    <svg id="railroad-svg" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">
                        <!-- Map background and tracks will be drawn by JS -->
                    </svg>
                </div>
                <div class="map-sidebar">
                    <h3>Miles Traveled</h3>
                    <div id="player-positions"></div>
                </div>
            </div>

            <main class="game-main">
                <!-- Roll Phase - 3 Column Layout -->
                <div id="roll-phase" class="phase-content roll-phase-layout">
                    <!-- Left Column: Cards -->
                    <div class="roll-column roll-column-left">
                        <div id="card-hand-section" class="card-hand-section">
                            <h3>Your Cards <span id="hand-count">(0)</span></h3>
                            <div id="card-hand"></div>
                        </div>
                    </div>

                    <!-- Center Column: Dice & Buttons -->
                    <div class="roll-column roll-column-center">
                        <div class="player-resources">
                            <span class="resource">Fuel: <span id="player-fuel">0</span></span>
                            <span class="resource">Gold: <span id="player-gold-display">0</span></span>
                        </div>
                        <div class="dice-area">
                            <h3>Roll Your Dice</h3>
                            <div id="dice-container"></div>
                            <div id="fuel-bonus" class="hidden">
                                Fuel Bonus: +<span id="fuel-bonus-amount">0</span>
                            </div>
                            <div id="roll-total" class="hidden">
                                Total: <span id="total-miles">0</span> miles
                            </div>
                            <div id="reroll-info" class="hidden">
                                Rerolls: <span id="rerolls-remaining">0</span> (click dice)
                            </div>
                            <div class="dice-buttons">
                                <button id="roll-dice-btn" class="btn btn-primary">Roll Dice</button>
                                <button id="continue-to-station" class="btn btn-secondary hidden">Continue to Station</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Train -->
                    <div class="roll-column roll-column-right">
                        <div class="train-display">
                            <h3>Your Train</h3>
                            <div id="train-cars-display"></div>
                        </div>
                    </div>
                </div>

                <!-- Station Phase -->
                <div id="station-phase" class="phase-content hidden">
                    <div class="station-display">
                        <h3>Station Arrived!</h3>
                        <div id="station-earnings">
                            <p>Your train cars earned you:</p>
                            <div id="earnings-breakdown"></div>
                            <div id="total-earnings" class="gold-display">
                                +<span id="gold-earned">0</span> Gold
                            </div>
                            <div id="fuel-gained" class="fuel-display hidden">
                                +<span id="fuel-earned">0</span> Fuel
                            </div>
                        </div>
                        <button id="continue-to-shop" class="btn btn-primary">Continue to Shop</button>
                    </div>
                </div>

                <!-- Shop Phase -->
                <div id="shop-phase" class="phase-content hidden">
                    <div class="shop-display">
                        <h3>Train Depot</h3>
                        <p class="shop-instructions">Permanent cards activate immediately. One-time cards go to your hand.</p>
                        <div class="shop-gold">
                            Your Gold: <span id="shop-player-gold">0</span>
                        </div>

                        <div class="shop-sections">
                            <div class="shop-section">
                                <h4>Train Cars</h4>
                                <div id="train-car-shop"></div>
                            </div>
                            <div class="shop-section">
                                <h4>Enhancement Cards</h4>
                                <div id="enhancement-shop"></div>
                            </div>
                        </div>

                        <button id="skip-shop" class="btn btn-primary">End Turn</button>
                    </div>
                </div>
            </main>

            <!-- Player Panels (Bottom) -->
            <div class="players-panel-bottom">
                <div id="players-container"></div>
            </div>

            <!-- Bottom Controls -->
            <div class="bottom-controls">
                <button id="back-to-menu" class="btn btn-secondary">Back to Main Menu</button>
                <div class="sound-controls">
                    <button id="music-toggle" class="sound-btn" title="Toggle Music">
                        <span class="sound-icon">&#x1F3B5;</span>
                    </button>
                    <button id="sound-toggle" class="sound-btn" title="Toggle Sound">
                        <span class="sound-icon">&#x1F50A;</span>
                    </button>
                    <input type="range" id="volume-slider" min="0" max="100" value="50" class="volume-slider">
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="screen">
            <h1>Game Over!</h1>
            <div id="final-standings"></div>
            <button id="play-again" class="btn btn-primary">Play Again</button>
        </div>
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
